!function t(e,r,a){function n(s,o){if(!r[s]){if(!e[s]){var u="function"==typeof require&&require;if(!o&&u)return u(s,!0);if(i)return i(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return n(r?r:t)},h,h.exports,t,e,r,a)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<a.length;s++)n(a[s]);return n}({1:[function(t,e,r){"use strict";e.exports={environment:"development",exportData:!0,backgroundMode:!0,deviceOrientation:{android:"portrait-primary",ios:"landscape-primary"},particles:{N:30,effectiveParticleThreshold:15,user:{defaultPose:{x:0,y:0,theta:0},sdStep:.15,sdHeading:.1},init:{N:200,sd:1,randomN:0,effectiveParticleThreshold:75,maxVariance:4}},pedometer:{stepSize:.5},landmarkConfig:{n:2,txPower:-64,noise:4,range:20,distToFloor:0,deviceHeight:0},sensor:{motion:{frequency:100},rssi:{kalman:{R:.008,Q:4},minMeasurements:30}},ble:{frequency:10,devicePrefix:"LowBeacon",toFriendlyName:function(t){var e=t.split("_");return 1===e.length?e[0]:t.includes("2015")?e[0]:e[0]+e[1]}},simulation:{xMax:10,yMax:10,sensorUpdateRate:50,broadcastsPerStep:20,landmarks:{LowBeacon1:{x:3.76,y:7.87},LowBeacon2:{x:7.36,y:7.87},LowBeacon3:{x:7.13,y:0},LowBeacon4:{x:4.13,y:0},LowBeacon5:{x:1.13,y:0},LowBeacon6:{x:1.93,y:1.3},LowBeacon7:{x:3.94,y:5.42}},user:{x:2.46,y:3.8,theta:0,sdStep:.15,sdHeading:.1},path:[{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:0},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:.5*Math.PI},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:0},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-.5*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI},{r:.5,theta:-1*Math.PI}]},replay:{showVisualisation:!0,updateRate:10,delayAlgorithm:!0}}},{}],2:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("../util/kalman"),o=a(s),u=function(){function t(e){n(this,t);var r=Math.round(2/(e/1e3));this.accNorm=new Array(r),this.varAcc=0,this.minAcc=1,this.maxAcc=-(1/0),this.threshold=-(1/0),this.sensibility=1/30,this.stepCount=0,this.stepArr=new Array(r),this.updateRate=e,this.filter=new o["default"],this.callbackOnStep=void 0}return i(t,[{key:"processMeasurement",value:function(t,e,r){var a=this._computeNorm(t,e,r);this.accNorm.push(a),this.accNorm.shift(),this._stepDetection()}},{key:"onStep",value:function(t){this.callbackOnStep=t}},{key:"_stepDetection",value:function(){this._computeAccelerationVariance(),this.minAcc=Math.min.apply(null,this.accNorm),this.maxAcc=Math.max.apply(null,this.accNorm),this.threshold=(this.minAcc+this.maxAcc)/2;var t=this.maxAcc-this.minAcc;Math.abs(t)>=this.sensibility&&this.accNorm[this.accNorm.length-1]>=this.threshold&&this.accNorm[this.accNorm.length-2]<this.threshold&&0===this.stepArr[this.stepArr.length-1]?(this.stepCount++,this.stepArr.push(1),this.stepArr.shift(),void 0!==this.callbackOnStep&&this.callbackOnStep()):(this.stepArr.push(0),this.stepArr.shift())}},{key:"_computeNorm",value:function(t,e,r){var a=Math.sqrt(t*t+e*e+r*r),n=this.filter.filter(a);return n/9.80665}},{key:"_computeAccelerationVariance",value:function(){for(var t=0,e=0,r=0;r<this.accNorm.length-1;r++)t+=this.accNorm[r],e+=this.accNorm[r]*this.accNorm[r];this.varAcc=(t*t-e)/this.accNorm.length,this.varAcc-.5>0&&(this.varAcc-=.5),isNaN(this.varAcc)?this.sensibility=1/30:(this.filter.setMeasurementNoise(this.varAcc),this.sensibility=2*(Math.sqrt(this.varAcc)/(9.80665*9.80665)))}}]),t}();r["default"]=u,e.exports=r["default"]},{"../util/kalman":13}],3:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("./landmark-particle-set"),o=a(s),u=function(){function t(e){var r=e.N,a=e.sd,i=e.randomN,s=e.effectiveParticleThreshold,o=e.maxVariance;n(this,t),this.nParticles=r,this.stdRange=a,this.randomParticles=i,this.maxVariance=o,this.effectiveParticleThreshold=void 0===s?nParticles/1.5:s,this.particleSetMap=new Map}return i(t,[{key:"addMeasurement",value:function(t,e,r,a){return this.has(t)||this.particleSetMap.set(t,new o["default"](this.nParticles,this.stdRange,this.randomParticles,this.effectiveParticleThreshold,this.maxVariance)),this.particleSetMap.get(t).addMeasurement(e,r,a),this}},{key:"has",value:function(t){return this.particleSetMap.has(t)}},{key:"estimate",value:function(t){return this.particleSetMap.get(t).positionEstimate()}},{key:"remove",value:function(t){this.particleSetMap["delete"](t)}},{key:"particleSets",value:function(){return this.particleSetMap.values()}}]),t}();r["default"]=u,e.exports=r["default"]},{"./landmark-particle-set":4}],4:[function(t,e,r){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=t("../util/math"),s=t("../util/sampling"),o=t("../util/motion"),u=function(){function t(e,r,n,i,s){a(this,t),this.nParticles=e,this.stdRange=r,this.effectiveParticleThreshold=i,this.randomParticles=n,this.maxVariance=s,this.measurements=0,this.particles=[]}return n(t,[{key:"addMeasurement",value:function(t,e,r){if(0===this.measurements)this.particles=this._randomParticles(this.nParticles,t,e,r);else{this._updateWeights(t,e,r);var a=this.particles.map(function(t){return t.weight});if(s.numberOfEffectiveParticles(a)<this.effectiveParticleThreshold){var n=this._resample(this.nParticles-this.randomParticles);this.particles=n.concat(this._randomParticles(this.randomParticles,t,e,r))}}return this.measurements++,this}},{key:"positionEstimate",value:function(){if(this.measurements<10)return{estimate:0,x:0,y:0,varX:1,varY:1};var t=this._particleVariance(),e=t.varX,r=t.varY;if(8>e&&8>r){var a=this.averagePosition(),n=a.x,i=a.y;return{estimate:1,x:n,y:i,varX:e,varY:r}}return{estimate:0,x:0,y:0,varX:1,varY:1}}},{key:"bestParticle",value:function(){var t=this.particles[0];return this.particles.forEach(function(e){e.weight>t.weight&&(t=e)}),t}},{key:"averagePosition",value:function(){var t=s.normalizeWeights(this.particles.map(function(t){return t.weight}));return{x:this.particles.reduce(function(e,r,a){return e+t[a]*r.x},0),y:this.particles.reduce(function(e,r,a){return e+t[a]*r.y},0)}}},{key:"_particleVariance",value:function(){return{varX:i.variance(this.particles,function(t){return t.x}),varY:i.variance(this.particles,function(t){return t.y})}}},{key:"_resample",value:function(t){var e=this,r=this.particles.map(function(t){return t.weight});return s.lowVarianceSampling(t,r).map(function(t){return{x:i.randn(e.particles[t].x,e.stdRange/4),y:i.randn(e.particles[t].y,e.stdRange/4),weight:1}})}},{key:"_randomParticles",value:function(t,e,r,a){for(var n=2*Math.PI/t,s=[],u=0;t>u;u++){var l=u*n,h=a+i.randn(0,this.stdRange),c=o.polarToCartesian(h,l),f=c.dx,d=c.dy;s.push({x:e+f,y:r+d,weight:1})}return s}},{key:"_updateWeights",value:function(t,e,r){var a=this;this.particles.forEach(function(n){var s=Math.sqrt(Math.pow(n.x-t,2)+Math.pow(n.y-e,2)),o=i.pdfn(r,s,a.stdRange);n.weight=n.weight*o})}}]),t}();r["default"]=u,e.exports=r["default"]},{"../util/math":15,"../util/motion":16,"../util/sampling":17}],5:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("./particle"),o=a(s),u=t("./landmark-init-set"),l=a(u),h=t("../util/sampling"),c=function(){function t(e,r,a,i){n(this,t),this.nParticles=e,this.effectiveParticleThreshold=r,this.particleList=[],this.initialisedLandmarks=[],this.landmarkInitSet=new l["default"](i);for(var s=0;e>s;s++)this.particleList.push(new o["default"](a))}return i(t,[{key:"samplePose",value:function(t){return this.particleList.forEach(function(e){return e.samplePose(t)}),this}},{key:"processObservation",value:function(t){var e=this;if(t!=={}){var r=t.uid,a=t.r,n=(t.name,t.moved);n&&(console.log("Moving landmark"),this._removeLandmark(r)),-1==this.initialisedLandmarks.indexOf(r)?!function(){var n=e.userEstimate(),i=n.x,s=n.y;e.landmarkInitSet.addMeasurement(r,i,s,a);var o=e.landmarkInitSet.estimate(r),u=o.estimate,l=o.x,h=o.y,c=o.varX,f=o.varY;u>.6&&(e.particleList.forEach(function(e){e.addLandmark(t,{x:l,y:h},{varX:c,varY:f})}),e.landmarkInitSet.remove(r),e.initialisedLandmarks.push(r))}():this.particleList.forEach(function(e){return e.processObservation(t)})}return this}},{key:"resample",value:function(){var t=this,e=this.particleList.map(function(t){return t.weight});return h.numberOfEffectiveParticles(e)<this.effectiveParticleThreshold&&(console.log("resampling"),this.particleList=h.lowVarianceSampling(this.nParticles,e).map(function(e){return new o["default"]({},t.particleList[e])})),this}},{key:"particles",value:function(){return this.particleList}},{key:"bestParticle",value:function(){var t=this.particleList[0];return this.particleList.forEach(function(e){e.weight>t.weight&&(t=e)}),t}},{key:"landmarkEstimate",value:function(){var t=h.normalizeWeights(this.particleList.map(function(t){return t.weight})),e=new Map;return this.particleList.forEach(function(r,a){r.landmarks.forEach(function(r,n){if(e.has(n)){var i=e.get(n);i.x+=t[a]*r.x,i.y+=t[a]*r.y}else e.set(n,{x:t[a]*r.x,y:t[a]*r.y,uid:n,name:r.name})})}),e}},{key:"userEstimate",value:function(){var t=h.normalizeWeights(this.particleList.map(function(t){return t.weight}));return{x:this.particleList.reduce(function(e,r,a){return e+t[a]*r.user.x},0),y:this.particleList.reduce(function(e,r,a){return e+t[a]*r.user.y},0)}}},{key:"_removeLandmark",value:function(t){var e=this.initialisedLandmarks.indexOf(t);-1!=e?(this.initialisedLandmarks.splice(e,1),this.particleList.forEach(function(e){return e.removeLandmark(t)})):this.landmarkInitSet.has(t)&&this.landmarkInitSet.remove(t)}}]),t}();r["default"]=c,e.exports=r["default"]},{"../util/sampling":17,"./landmark-init-set":3,"./particle":6}],6:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t)){var r=[],a=!0,n=!1,i=void 0;try{for(var s,o=t[Symbol.iterator]();!(a=(s=o.next()).done)&&(r.push(s.value),!e||r.length!==e);a=!0);}catch(u){n=!0,i=u}finally{try{!a&&o["return"]&&o["return"]()}finally{if(n)throw i}}return r}throw new TypeError("Invalid attempt to destructure non-iterable instance")}function i(t){if(Array.isArray(t)){for(var e=0,r=Array(t.length);e<t.length;e++)r[e]=t[e];return r}return Array.from(t)}function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),u=t("./user"),l=a(u),h=t("../util/math"),c=function(){function t(e){var r=void 0===arguments[1]?void 0:arguments[1];s(this,t),void 0!==r?(this.user=l["default"].copyUser(r.user),this.landmarks=this._copyMap(r.landmarks)):(this.user=new l["default"](e.defaultPose,e),this.landmarks=new Map),this.weight=1}return o(t,[{key:"samplePose",value:function(t){return this.user.samplePose(t),this}},{key:"resetWeight",value:function(){return this.weight=1,this}},{key:"addLandmark",value:function(t,e){var r=t.uid,a=(t.r,t.name),n=e.x,i=e.y,s=void 0===arguments[2]?{varX:1,varY:1}:arguments[2],o=s.varX,u=s.varY,l={x:n,y:i,name:a,cov:[[o,0],[0,u]]};this.landmarks.set(r,l)}},{key:"removeLandmark",value:function(t){this.landmarks["delete"](t)}},{key:"processObservation",value:function(t){var e=t.uid,r=t.r,a=this.landmarks.get(e),n=this.user.x-a.x,i=this.user.y-a.y,s=h.randn(2,.1),o=Math.max(.001,Math.sqrt(n*n+i*i)),u=r-o,l=[-n/o,-i/o],c=[a.cov[0][0]*l[0]+a.cov[0][1]*l[1],a.cov[1][0]*l[0]+a.cov[1][1]*l[1]],f=c[0]*l[0]+c[1]*l[1]+s,d=[c[0]*(1/f),c[1]*(1/f)],v=a.x+d[0]*u,m=a.y+d[1]*u,p=[[d[0]*d[0]*f,d[0]*d[1]*f],[d[1]*d[0]*f,d[1]*d[1]*f]],y=[[a.cov[0][0]-p[0][0],a.cov[0][1]-p[0][1]],[a.cov[1][0]-p[1][0],a.cov[1][1]-p[1][1]]];this.weight=this.weight*h.pdfn(r,o,f),a.x=v,a.y=m,a.cov=y}},{key:"_copyMap",value:function(t){var e=new Map,r=!0,a=!1,i=void 0;try{for(var s,o=t.entries()[Symbol.iterator]();!(r=(s=o.next()).done);r=!0){var u=n(s.value,2),l=u[0],h=u[1];e.set(l,this._copyLandmark(h))}}catch(c){a=!0,i=c}finally{try{!r&&o["return"]&&o["return"]()}finally{if(a)throw i}}return e}},{key:"_copyLandmark",value:function(t){var e={};return e.x=t.x,e.y=t.y,e.name=t.name,e.cov=[].concat(i(t.cov)),e}}]),t}();r["default"]=c,e.exports=r["default"]},{"../util/math":15,"./user":8}],7:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("../util/kalman"),o=a(s),u=t("../config"),l=a(u),h=function(){function t(e){var r=e.n,a=e.txPower,i=e.noise,s=e.range,o=e.deviceHeight,u=e.distToFloor,l=void 0===arguments[1]?{}:arguments[1],h=l.R,c=void 0===h?.008:h,f=l.Q,d=void 0===f?void 0:f,v=void 0===arguments[2]?5:arguments[2];n(this,t),this.landmarks=new Map,this.landmarkConfig={n:r,txPower:a,noise:i,range:s,deviceHeight:o,distToFloor:u},void 0===d&&(d=i),this.R=c,this.Q=d,this.minMeasurements=v,this.hasMoved=void 0,this.eventListener=void 0}return i(t,[{key:"addObservation",value:function(t,e,r){e>0||(this.landmarks.has(t)?this._hasMoved(t,r)?this._moveLandmark(t,e,r):this._updateLandmark(t,e):this._registerLandmark(t,e,r))}},{key:"getObservations",value:function(){var t=this,e=[];return this.landmarks.forEach(function(r,a){if(r.changed&&r.measurements>t.minMeasurements){var n=r.filter.lastMeasurement(),i=l["default"].ble.toFriendlyName(r.name);e.push({uid:a,r:t._rssiToDistance(n),name:i,moved:r.moved}),r.changed=!1,r.moved=!1}}),e}},{key:"hasMovedIf",value:function(t){return this.hasMoved=t,this}},{key:"setEventListener",value:function(t){return this.eventListener=t,this}},{key:"_updateLandmark",value:function(t,e){var r=this.landmarks.get(t);this._event(t,r.name,"update","Landmark updated"),r.filter.filter(e),r.measurements++,r.changed=!0}},{key:"_registerLandmark",value:function(t,e,r){var a=void 0===arguments[3]?!1:arguments[3];a||this._event(t,r,"new","New landmark found with name "+r);var n=new o["default"]({R:this.R,Q:this.Q});n.filter(e),this.landmarks.set(t,{uid:t,changed:!0,name:r,filter:n,measurements:1,moved:a})}},{key:"_hasMoved",value:function(t,e){var r=this.landmarks.get(t);return void 0!==this.hasMoved&&this.hasMoved({uid:t,name:e},{uid:r.uid,name:r.name})}},{key:"_moveLandmark",value:function(t,e,r){this._event(t,r,"moved","Landmark has moved"),this._registerLandmark(t,e,r,!0)}},{key:"_rssiToDistance",value:function(t){var e=this.landmarkConfig.deviceHeight-this.landmarkConfig.distToFloor,r=Math.pow(10,(t-this.landmarkConfig.txPower)/(-10*this.landmarkConfig.n));return Math.sqrt(r*r-e*e)}},{key:"_event",value:function(t,e,r,a){void 0!==this.eventListener&&this.eventListener(t,e,r,a)}}]),t}();r["default"]=h,e.exports=r["default"]},{"../config":1,"../util/kalman":13}],8:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("../util/motion"),o=t("../util/math"),u=t("../util/linked-list"),l=a(u),h=function(){function t(e,r){var a=e.x,i=e.y,s=e.theta,o=void 0===arguments[2]?void 0:arguments[2];n(this,t),this.x=a,this.y=i,this.theta=s,this.userConfig=r,this.previousOdometry={x:a,y:i,theta:s},this.trace=void 0===o?(new l["default"]).add({x:a,y:i,theta:s}):new l["default"](o)}return i(t,[{key:"move",value:function(t){var e=t.r,r=t.theta,a=s.polarToCartesian(e,r),n=a.dx,i=a.dy;return this.x+=n,this.y+=i,this.theta=r,this.trace.add({x:this.x,y:this.y,theta:this.theta}),this}},{key:"samplePose",value:function(t){var e=t.r,r=t.theta,a=this.userConfig.sdHeading,n=s.limitTheta(o.randn(r,a)),i=this.userConfig.sdStep,u=o.randn(e,i),l=s.polarToCartesian(u,n),h=l.dx,c=l.dy;return this.x+=h,this.y+=c,this.theta=n,this.trace.add({x:this.x,y:this.y,theta:this.theta}),this}}],[{key:"copyUser",value:function(e){return new t({x:e.x,y:e.y,theta:e.theta},e.userConfig,e.trace)}}]),t}();r["default"]=h,e.exports=r["default"]},{"../util/linked-list":14,"../util/math":15,"../util/motion":16}],9:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),o=function(t,e,r){for(var a=!0;a;){var n=t,i=e,s=r;o=l=u=void 0,a=!1;var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,r=s,a=!0}},u=t("../models/user"),l=a(u),h=function(t){function e(t,r){n(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.iteration=0,this.path=r,this.lastControl={r:0,theta:0}}return i(e,t),s(e,[{key:"walk",value:function(){return this.iteration>=this.path.length?(this.lastControl={r:0,theta:0},!1):(this.move(this.path[this.iteration]),this.lastControl=this.path[this.iteration],this.iteration++,!0)}},{key:"getLastControl",value:function(){return this.lastControl}}]),e}(l["default"]);r["default"]=h,e.exports=r["default"]},{"../models/user":8}],10:[function(t,e,r){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){return Math.pow(10,(t-e.txPower)/(-10*e.n))}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}();r.rssiToDistance=n;var s=t("../util/math"),o=function(){function t(e,r,n,i){var s=r.xRange,o=r.yRange,u=void 0===arguments[4]?{}:arguments[4];if(a(this,t),this.landmarks=[],this.xRange=s,this.yRange=o,this.updateRate=n,this.landmarkConfig=i,this.broadcastId=void 0,u==={})for(var l=0;e>l;l++)this.landmarks.push(this._randomLandmark("landmark-"+l));else for(var h in u)u.hasOwnProperty(h)&&this.landmarks.push(this._landmarkFromCoordinate(h,u[h]))}return i(t,[{key:"startBroadcast",value:function(t,e){var r=this;this.broadcastId=window.setTimeout(function(){return r._broadCast(t,e)},this.updateRate)}},{key:"stopBroadCast",value:function(){void 0!==this.broadcastId&&window.clearTimeout(this.broadcastId)}},{key:"simulateBroadcasts",value:function(t,e,r){for(var a=0;t>a;a++)this._broadCast(e,r,!1)}},{key:"setUpdateRate",value:function(t){return this.updateRate=t,this}},{key:"measurementsAtPoint",value:function(t,e){var r=this.landmarksInRange(t,e);return r.map(function(r){return{uid:r.uid,rssi:r.rssiAt(t,e),name:r.name}})}},{key:"randomMeasurementAtPoint",value:function(t,e){var r=this.landmarksInRange(t,e);if(r.length>0){var a=r[Math.floor(Math.random()*r.length)];return{uid:a.uid,rssi:a.rssiAt(t,e),name:a.name,address:a.address}}}},{key:"landmarksInRange",value:function(t,e){return this.landmarks.filter(function(r){return r.isInRange(t,e)})}},{key:"_randomLandmark",value:function(t){return new u(t,{x:Math.random()*this.xRange,y:Math.random()*this.yRange},this.landmarkConfig)}},{key:"_landmarkFromCoordinate",value:function(t,e){return new u(t,{x:e.x,y:e.y},this.landmarkConfig)}},{key:"_broadCast",value:function(t,e){var r=this,a=void 0===arguments[2]?!0:arguments[2],n=this.measurementsAtPoint(e.x,e.y);n.forEach(function(e){void 0!==e&&t.addDeviceObservation(e.uid,e.rssi,e.name)}),a&&(this.broadcastId=window.setTimeout(function(){return r._broadCast(t,e)},this.updateRate))}},{key:"landmarkByUid",value:function(t){for(var e=0;e<this.landmarks.length;e++)if(this.landmarks[e].uid==t)return this.landmarks[e]}}]),t}();r.SimulatedLandmarkSet=o,r["default"]=o;var u=function(){function t(e,r,n){var i=r.x,s=r.y,o=n.n,u=n.txPower,l=n.noise,h=n.range;a(this,t),this.uid=e,this.x=i,this.y=s,this.landmarkRange=h,this.n=o,this.txPower=u,this.noise=l,this.name=e,this.address="addr:"+e}return i(t,[{key:"isInRange",value:function(t,e){return this.distanceTo(t,e)<=this.landmarkRange}},{key:"distanceTo",value:function(t,e){return Math.sqrt(Math.pow(this.x-t,2)+Math.pow(this.y-e,2))}},{key:"rssiAtRaw",value:function(t,e){return this.txPower-10*this.n*s.log(Math.max(this.distanceTo(t,e),.1),10)}},{key:"rssiAt",value:function(t,e){return this.rssiAtRaw(t,e)+s.randn(0,this.noise)}}]),t}();r["default"]=u},{"../util/math":15}],11:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),o=function(t,e,r){for(var a=!0;a;){var n=t,i=e,s=r;o=l=u=void 0,a=!1;var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,r=s,a=!0}},u=t("../models/user"),l=a(u),h=t("../util/motion"),c=function(t){function e(t,r,a){var i=a.xRange,s=a.yRange,u=a.padding;n(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.v=r,this.xRange=i,this.yRange=s,this.padding=u,this.lastControl={r:0,theta:0},this.iteration=0}return i(e,t),s(e,[{key:"setPath",value:function(t,e){this.distances=t,this.angles=e}},{key:"randomWalk",value:function(){var t=this._newStep(),e=t.r,r=t.theta,a=this.x,n=this.y,i=h.polarToCartesian(e,h.limitTheta(r+this.theta)),s=i.dx,o=i.dy,u=this._constrainCoordinate(a+s,this.xRange-this.padding,-this.xRange+this.padding),l=this._constrainCoordinate(n+o,this.yRange-this.padding,-this.yRange+this.padding),c=h.cartesianToPolar(u-a,l-n);return this.move({r:c.r,theta:c.theta}),this.lastControl={r:c.r,theta:c.theta},this}},{key:"getLastControl",value:function(){return this.lastControl}},{key:"_constrainCoordinate",value:function(t,e,r){return t>e?e:r>t?r:t}},{key:"_newStep",value:function(){if(void 0!==this.distances&&void 0!==this.angles){if(this.iteration<this.distances.length){var t={r:this.distances[this.iteration],theta:this.angles[this.iteration]};return this.iteration++,t}if(this.iteration==this.distances.length)return console.debug("Simulater reached end of trace data"),{r:0,theta:0};this.iteration++}return this.iteration+=.1,{r:this.v+this.iteration,theta:.5}}}]),e}(l["default"]);r["default"]=c,e.exports=r["default"]},{"../models/user":8,"../util/motion":16}],12:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),s=t("./models/particle-set"),o=a(s),u=t("./models/sensor"),l=a(u),h=t("./device/pedometer"),c=a(h),f=function(){function t(e){var r=this;n(this,t),this.particleSet=new o["default"](e.particles.N,e.particles.effectiveParticleThreshold,e.particles.user,e.particles.init),this.sensor=new l["default"](e.landmarkConfig,e.sensor.rssi.kalman,e.sensor.rssi.minMeasurements),this.sensor.hasMovedIf(function(t,e){return t.uid==e.uid&&t.name!=e.name}),this.pedometer=new c["default"](e.sensor.motion.frequency),this.pedometer.onStep(function(){return r._update()}),this.heading=e.particles.user.defaultPose.theta,this.stepSize=e.pedometer.stepSize,this.iteration=0,this.started=!1,this.paused=!1,this.afterUpdateCallback=void 0,this.beforeUpdateCallback=void 0,this.lastObservations=[]}return i(t,[{key:"start",value:function(){return this.started=!0,this.paused=!1,this}},{key:"pause",value:function(){return this.started=!this.started,this.paused=!0,this}},{key:"addMotionObservation",value:function(t,e,r,a){this.started&&(this.pedometer.processMeasurement(t,e,r),this.heading=a)}},{key:"addDeviceObservation",value:function(t,e,r){this.started&&this.sensor.addObservation(t,e,r)}},{key:"onUpdate",value:function(t){this.afterUpdateCallback=t}},{key:"beforeUpdate",value:function(t){this.beforeUpdateCallback=t}},{key:"_update",value:function(){var t=this;if(this.started){void 0!==this.beforeUpdateCallback&&this.beforeUpdateCallback(this.particleSet,this.iteration),console.log("[SLACjs/controller] Update running");var e=1*this.stepSize,r=this.heading;this.particleSet.samplePose({r:e,theta:r}),this.lastObservations=this.sensor.getObservations(),this.lastObservations.forEach(function(e){t.particleSet.processObservation(e)}),this.particleSet.resample(),this.iteration++,void 0!==this.afterUpdateCallback&&this.afterUpdateCallback(this.particleSet,this.iteration)}}}]),t}();r["default"]=f,e.exports=r["default"]},{"./device/pedometer":2,"./models/particle-set":5,"./models/sensor":7}],13:[function(t,e,r){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(){var e=void 0===arguments[0]?{}:arguments[0],r=e.R,n=void 0===r?1:r,i=e.Q,s=void 0===i?1:i,o=e.A,u=void 0===o?1:o,l=e.B,h=void 0===l?0:l,c=e.C,f=void 0===c?1:c;a(this,t),this.R=n,this.Q=s,this.A=u,this.C=f,this.B=h,this.cov=0/0,this.x=0/0}return n(t,[{key:"filter",value:function(t){var e=void 0===arguments[1]?0:arguments[1];if(isNaN(this.x))this.x=1/this.C*t,this.cov=1/this.C*this.Q*(1/this.C);else{var r=this.A*this.x+this.B*e,a=this.A*this.cov*this.A+this.R,n=a*this.C*(1/(this.C*a*this.C+this.Q));this.x=r+n*(t-this.C*r),this.cov=a-n*this.C*a}return this.x}},{key:"lastMeasurement",value:function(){return this.x}},{key:"setMeasurementNoise",value:function(t){this.Q=t}},{key:"setProcessNoise",value:function(t){this.R=t}}]),t}();r["default"]=i,e.exports=r["default"]},{}],14:[function(t,e,r){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(){var e=void 0===arguments[0]?void 0:arguments[0];a(this,t),void 0!==e&&"object"!=typeof e&&console.error("Base must be a LinkedList"),this.list=[e]}return n(t,[{key:"add",value:function(t){return this.list.push(t),this}},{key:"values",value:function e(){var e=[];return void 0!==this.list[0]&&(e=this.list[0].values()),e=e.concat(this.list.slice(1))}},{key:"currentValues",value:function(){return this.list.slice(1)}},{key:"hasParent",value:function(){return void 0!==this.list[0]}},{key:"last",value:function(){return this.list[this.list.length-1]}},{key:"getBase",value:function(){return this.list[0]}}]),t}();r["default"]=i,e.exports=r["default"]},{}],15:[function(t,e,r){"use strict";function a(t,e){var r=void 0,a=void 0,n=void 0,i=void 0,s=void 0;do r=Math.random(),a=1.7156*(Math.random()-.5),n=r-.449871,i=Math.abs(a)+.386595,s=n*n+i*(.196*i-.25472*n);while(s>.27597&&(s>.27846||a*a>-4*Math.log(r)*r*r));return a/r*e+t}function n(t,e,r){return 1/(r*Math.sqrt(2*Math.PI))*Math.exp(-Math.pow(t-e,2)/(2*r*r))}function i(t,e){return Math.log(t)/Math.log(e)}function s(t){var e=t[0][0],r=t[0][1],a=t[1][0],n=t[1][1],i=1,s=-(e+n),o=-s+Math.sqrt(Math.pow(e-n,2)+4*a*n)/2*i,u=-s-Math.sqrt(Math.pow(e-n,2)+4*a*n)/2*i,l=(o-e)/r,h=(u-e)/r,c=Math.sqrt(1+l*l),f=Math.sqrt(1+h*h);

return{values:[o,u],vectors:[[1/c,l/c],[1/f,h/f]]}}function o(t,e){var r=0,a=0,n=t.length;return t.forEach(function(t){var n=e(t);r+=n,a+=n*n}),(a-r*r/n)/n}Object.defineProperty(r,"__esModule",{value:!0}),r.randn=a,r.pdfn=n,r.log=i,r.eigenvv=s,r.variance=o},{}],16:[function(t,e,r){"use strict";function a(t,e){var r=t-e;return 0>r?r+=360:r>360&&(r-=360),i(l(c(r)))}function n(t,e){console.error("Function is deprecated, use limitTheta instead.");var r=t+e;return r>Math.PI?Math.PI-r:r<-Math.PI?-Math.PI-r:r}function i(t){return t>Math.PI?t-2*Math.PI:t<-Math.PI?t+2*Math.PI:t}function s(t,e){var r=t,a=e;0>t&&(t+=2*Math.PI),0>e&&(e+=2*Math.PI);var n=o(1,t),i=n.dx,s=n.dy,l=o(1,e),h=l.dx,c=l.dy,f=(i+h)/2,d=(s+c)/2,v=u(f,d),m=v.theta;return console.log({oldTheta1:r,oldTheta2:a,theta1:t,theta2:e,heading:m}),m}function o(t,e){var r=t*Math.cos(e),a=t*Math.sin(e);return{dx:r,dy:a}}function u(t,e){var r=Math.sqrt(t*t+e*e),a=Math.atan2(e,t);return{r:r,theta:a}}function l(t){return t*(Math.PI/180)}function h(t){return t*(180/Math.PI)}function c(t){return 360-t}function f(t,e){t+=.5*Math.PI;var r=t-e,a=2*Math.PI-e-t;return a>r?-1*h(r):h(a)}Object.defineProperty(r,"__esModule",{value:!0}),r.degreeToNormalisedHeading=a,r.addTheta=n,r.limitTheta=i,r.meanHeading=s,r.polarToCartesian=o,r.cartesianToPolar=u,r.degreeToRadian=l,r.radianToDegree=h,r.clockwiseToCounterClockwise=c,r.rotationToLocalNorth=f},{}],17:[function(t,e,r){"use strict";function a(t){var e=t.reduce(function(t,e){return t+e},0);return t.map(function(t){return t/e})}function n(t){var e=a(t),r=0;return e.map(function(t){return r=t+r})}function i(t,e){for(var r=e.length,n=a(e),i=Math.random()*(1/r),s=n[0],o=0,u=[],l=1;t>=l;l++){for(var h=i+(l-1)*(1/r);h>s;)o+=1,s+=n[o];u.push(o)}return u}function s(t,e){for(var r=n(e),a=[],i=0;t>i;i++)for(var s=Math.random(),o=0;o<r.length;o++)if(r[o]>=s){a.push(o);break}return a}function o(t){var e=a(t);return 1/e.reduce(function(t,e){return t+e*e})}Object.defineProperty(r,"__esModule",{value:!0}),r.normalizeWeights=a,r.weightedCumulativeSum=n,r.lowVarianceSampling=i,r.rouletteWheelSampling=s,r.numberOfEffectiveParticles=o},{}],18:[function(t,e,r){"use strict";function a(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),i=function(){function t(e){a(this,t),this.element=e,this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.xMax=1,this.yMax=1}return n(t,[{key:"clearCanvas",value:function(){return this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.restore(),this}},{key:"optimizeForRetina",value:function(){var t=void 0===arguments[0]?void 0:arguments[0],e=void 0,r=window.getComputedStyle(this.canvas);e=void 0===t?parseInt(r.getPropertyValue("height"),10):t;var a=parseInt(r.getPropertyValue("width"),10),n=window.devicePixelRatio&&2===window.devicePixelRatio?1.99:1;this.canvas.width=a*n,this.canvas.height=e*n,this.canvas.style.width=a+"px",this.canvas.style.height=e+"px"}},{key:"calculateScaleFactor",value:function(t,e){var r=this.canvas.width,a=this.canvas.height,n=r/t,i=a/e;return Math.min(n,i)}},{key:"plotUserTrace",value:function(t){var e=this,r=void 0===arguments[1]?"#A8A8A8":arguments[1],a=void 0===arguments[2]?3:arguments[2];this.ctx.lineJoin="round",this.ctx.lineWidth=a,this.ctx.fillStyle="#960E0E",this.ctx.strokeStyle=r,this.ctx.beginPath();var n=!1;return t.trace.values().forEach(function(t,r){var a=t.x,n=t.y,i=(t.theta,e.tx(a)),s=e.ty(n);0===r?e.ctx.moveTo(i,s):e.ctx.lineTo(i,s)}),this.ctx.stroke(),this.ctx.closePath(),n}},{key:"plotObject",value:function(t){var e=void 0===arguments[1]?"#000000":arguments[1],r=void 0===arguments[2]?3:arguments[2];this.ctx.fillStyle=e;var a=this.tx(t.x)-.5*r,n=this.ty(t.y)-.5*r;this.ctx.fillRect(a,n,r,r),void 0!==t.name&&(this.ctx.font="25px serif",this.ctx.fillStyle="#000000",this.ctx.fillText(t.name,a,n))}},{key:"plotLandmarkInitSet",value:function(t){var e=this,r=["rgb(228,26,28)","rgb(55,126,184)","rgb(77,175,74)","rgb(152,78,163)","rgb(255,127,0)","rgb(255,255,51)","rgb(166,86,40)","rgb(247,129,191)","rgb(153,153,153)"],a=0;t.particleSetMap.forEach(function(t){a>r.length&&(a=0),t.particles.forEach(function(t){e.plotObject(t,r[a],5)}),a++})}},{key:"tx",value:function(t){return t}},{key:"ty",value:function(t){return t}}]),t}();r["default"]=i,e.exports=r["default"]},{}],19:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),o=function(t,e,r){for(var a=!0;a;){var n=t,i=e,s=r;o=l=u=void 0,a=!1;var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,r=s,a=!0}},u=t("./base-renderer"),l=a(u),h=function(t){function e(t,r){var a=void 0===arguments[2]?12:arguments[2],i=void 0===arguments[3]?12:arguments[3],s=void 0===arguments[4]?1.5:arguments[4],u=void 0===arguments[5]?1.5:arguments[5];n(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t),this.trueLandmarkPositions=r,this.xMax=a,this.yMax=i,this.offsetX=s,this.offsetY=u,this.optimizeForRetina(),this.scaleFactor=this._calculateScaleFactor()}return i(e,t),s(e,[{key:"render",value:function(t){var e=this;this.clearCanvas();var r=t.bestParticle();t.particles().forEach(function(t){t!==r&&e.plotUserTrace(t.user,"#CCCCCC",3)}),this.plotLandmarkInitSet(t.landmarkInitSet),this.plotUserTrace(r.user,"#24780D"),r.landmarks.forEach(function(t){e.plotObject(t,"#B52B2B",15)});for(var a in this.trueLandmarkPositions)if(this.trueLandmarkPositions.hasOwnProperty(a)){var n=this.trueLandmarkPositions[a];n.name=a,this.plotObject(n,"#000000",15)}return this}},{key:"_calculateScaleFactor",value:function(){var t=this.canvas.width,e=this.canvas.height,r=t/(this.xMax+this.offsetX),a=e/(this.yMax+this.offsetY);return Math.min(r,a)}},{key:"tx",value:function(t){return(t+this.offsetX)*this.scaleFactor}},{key:"ty",value:function(t){return(this.yMax-(t+this.offsetY))*this.scaleFactor}}]),e}(l["default"]);r["default"]=h,e.exports=r["default"]},{"./base-renderer":18}],20:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(t.__proto__=e)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function t(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}return function(e,r,a){return r&&t(e.prototype,r),a&&t(e,a),e}}(),o=function(t,e,r){for(var a=!0;a;){var n=t,i=e,s=r;o=l=u=void 0,a=!1;var o=Object.getOwnPropertyDescriptor(n,i);if(void 0!==o){if("value"in o)return o.value;var u=o.get;return void 0===u?void 0:u.call(s)}var l=Object.getPrototypeOf(n);if(null===l)return void 0;t=l,e=i,r=s,a=!0}},u=t("./replay-renderer"),l=a(u),h=function(t){function e(t,r){var a=void 0===arguments[2]?12:arguments[2],i=void 0===arguments[3]?12:arguments[3],s=void 0===arguments[4]?1.5:arguments[4],u=void 0===arguments[5]?1.5:arguments[5];n(this,e),o(Object.getPrototypeOf(e.prototype),"constructor",this).call(this,t,r,a,i,s,u)}return i(e,t),s(e,[{key:"render",value:function(t,r){o(Object.getPrototypeOf(e.prototype),"render",this).call(this,t),this.plotUserTrace(r,"#4100E8",4)}},{key:"tx",value:function(t){return o(Object.getPrototypeOf(e.prototype),"tx",this).call(this,t)}},{key:"ty",value:function(t){return o(Object.getPrototypeOf(e.prototype),"ty",this).call(this,t)-125}}]),e}(l["default"]);r["default"]=h,e.exports=r["default"]},{"./replay-renderer":19}],21:[function(t,e,r){"use strict";function a(t){return t&&t.__esModule?t:{"default":t}}var n=t("./simulation/user"),i=(a(n),t("./simulation/fixed-user")),s=a(i),o=t("./simulation/landmark"),u=t("./slac-controller"),l=a(u),h=t("./view/simulation-renderer"),c=a(h),f=t("./config"),d=a(f),v=t("./util/math");window.SlacENV=d["default"].environment,window.SlacApp={user:void 0,renderer:void 0,controller:void 0,landmarks:void 0,error:{avg:0},initialize:function(){var t=this;d["default"].particles.user.defaultPose=d["default"].simulation.user,d["default"].landmarkConfig.distToFloor=0,d["default"].landmarkConfig.deviceHeight=0,d["default"].particles.user.sdStep=d["default"].simulation.user.sdStep,d["default"].particles.user.sdHeading=d["default"].simulation.user.sdHeading,this.controller=new l["default"](d["default"]),this.controller.start(),this.controller.onUpdate(function(e){return t.renderer.render(e,t.user)}),this.user=new s["default"](d["default"].simulation.user,d["default"].simulation.path),this.landmarks=new o.SimulatedLandmarkSet(20,{xRange:d["default"].simulation.xMax,yRange:d["default"].simulation.yMax},d["default"].simulation.sensorUpdateRate,d["default"].landmarkConfig,d["default"].simulation.landmarks),this.renderer=new c["default"]("slacjs-map",d["default"].simulation.landmarks,d["default"].simulation.xMax,d["default"].simulation.yMax,0,0)},reset:function(){var t=this;this.controller=new l["default"](d["default"]),this.controller.start(),this.controller.onUpdate(function(e){return t.renderer.render(e,t.user)})},step:function(){var t=this.user.walk();if(!t)return!1;this.landmarks.simulateBroadcasts(d["default"].simulation.broadcastsPerStep,this.controller,this.user);var e=this.user.getLastControl(),r=e.r,a=e.theta;return r=v.randn(r,.15),a=v.randn(a,.1),this.controller._stepSize=r,this.controller.heading=a,this.controller._update(),this._calculateLandmarkError(),!0},_calculateLandmarkError:function(){var t=this,e=[],r="";if(this.controller.particleSet.bestParticle().landmarks.forEach(function(a){var n=d["default"].simulation.landmarks[a.name],i=Math.sqrt(Math.pow(n.x-a.x,2)+Math.pow(n.y-a.y,2));e.push(i),t.error[a.name]=i,r+=a.name+": "+i+"<br>"}),e.length>0){$(".landmark-individual-error").html(r);var a=e.reduce(function(t,e){return t+e},0)/e.length;this.error.avg=a,$(".landmark-error").html(Math.round(100*a)/100)}}}},{"./config":1,"./simulation/fixed-user":9,"./simulation/landmark":10,"./simulation/user":11,"./slac-controller":12,"./util/math":15,"./view/simulation-renderer":20}]},{},[21]);